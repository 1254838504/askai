<!doctype html>
<html>

<head>
  <title>ASK AI</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-"
    crossorigin="anonymous">



  <!--[if lte IE 8]>
      <link rel="stylesheet" href="css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="css/side-menu.css">
  <!--<![endif]-->
  
  <link rel="stylesheet" href="css/custom.css">

</head>

<body>
  <div id="layout">
    <!-- Menu toggle -->
    <a href="#menu" id="menuLink" class="menu-link">
      <!-- Hamburger icon -->
      <span></span>
    </a>

    <div id="menu">
      <div class="pure-menu">
        <a class="pure-menu-heading" href="#">Ask AI</a>

        <ul class="pure-menu-list">
          <li class="pure-menu-item"><a href="#" class="pure-menu-link">Home</a></li>
          <li class="pure-menu-item"><a href="https://essaysai.netlify.com" class="pure-menu-link">Essays AI</a></li>
        </ul>
      </div>
    </div>

    <div id="main">
      <div class="header">
        <h1>Ask AI</h1>
      </div>

      <div class="content">
        <div class="pure-g">
          <div class="pure-u-1-1">
            <div class="page-wrapper">
              <div class="page-container">
                <div class="page-inner">
                  <form action="#" id="form">
                      <input type="text" id="question" x-webkit-speech>
                  </form>
                  
                  <div id="response"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- <footer><button class="pure-button" onclick="getData(editor.textContent);">Click here to trigger AI</a></footer> -->
  </div>

  <script>
    document.getElementById("form").addEventListener('submit', function (event) {
      var query = "Q:" + document.getElementById("question").value;
      getData(query);
      return false;      
    });
    function getData(data) {
      var req = new Request('/api/data', {
        method: 'post',
        mode: 'cors',
        redirect: 'follow',
        headers: {
          'Accept': 'application/json',
          'Content-Type': "application/json; charset=UTF-8"
        },
        body: JSON.stringify({ "data": data })
      });
      fetch(req)
        .then(function (response) {
          return response.json();
        }).then(function (jsonData) {
          // console.log(jsonData);
          let answer = jsonData.sentences[0].value.trim();
          answer = answer.replaceAll("A:", "");
          var utterance = new SpeechSynthesisUtterance(answer);
          var voices = window.speechSynthesis.getVoices();
          utterance.voice = voices.filter(function(voice) { return voice.name == 'Google UK English Male'; })[0];
          window.speechSynthesis.speak(utterance);
          
        }).catch(function (err) {
          console.log("Oops, Something went wrong!", err);
        })
    }

  </script>

  <script src="js/ui.js"></script>
</body>

</html>